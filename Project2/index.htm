<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê±âËØ≠Â≠¶‰π† ¬∑ H√°nY«î</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Nunito:wght@300;400;600;700;900&family=Noto+Sans+SC:wght@300;400;500&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="script.js" defer></script>
</head>
<body>
    <!-- Guard: prevents onclick errors if script loads slowly -->
    <script>
        window.showPage = function() {};
        window.openFile = function() {};
        window.toggleFolder = function() {};
        window.openSidebar = function() {};
        window.closeSidebar = function() {};
        window.showFabMenu = function() {};
        window.closeBottomSheet = function() {};
        window.toggleTheme = function() {};
    </script>

    <div class="toast" id="toast"></div>

    <!-- Context Menus -->
    <div class="ctx-menu" id="ctx-empty">
        <div class="ctx-item" onclick="createFolder()">üìÅ T·∫°o Folder</div>
        <div class="ctx-item" onclick="createFile()">üìÑ T·∫°o File</div>
    </div>
    <div class="ctx-menu" id="ctx-folder">
        <div class="ctx-item" onclick="renameItem()">ƒê·ªïi t√™n</div>
        <div class="ctx-item" onclick="copyItem()">Sao ch√©p</div>
        <div class="ctx-item" onclick="cutItem()">C·∫Øt</div>
        <div class="ctx-divider"></div>
        <div class="ctx-item" onclick="createSubFolder()">üìÅ T·∫°o folder con</div>
        <div class="ctx-item" onclick="createFile()">üìÑ T·∫°o file m·ªõi</div>
        <div class="ctx-divider"></div>
        <div class="ctx-item" onclick="exportExcel()">Xu·∫•t folder ‚Üí Excel</div>
    </div>
    <div class="ctx-menu" id="ctx-file">
        <div class="ctx-item" onclick="renameItem()">ƒê·ªïi t√™n</div>
        <div class="ctx-item" onclick="copyItem()">Sao ch√©p</div>
        <div class="ctx-item" onclick="cutItem()">C·∫Øt</div>
        <div class="ctx-divider"></div>
        <div class="ctx-item" onclick="exportExcel()">Xu·∫•t file ‚Üí Excel</div>
    </div>

    <!-- Sidebar Overlay (mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <!-- ========== HOME ========== -->
    <div class="page active" id="home">
        <div class="home-deco">Ê±â</div>
        <div class="home-center">
            <div class="greeting-wrap">
                <div class="greeting-sub">Ê¨¢ËøéÂõûÊù• ¬∑ T·ª´ Thanh S∆°n</div>
                <div class="greeting">Xin ch√†o Di·ªáu</div>
            </div>
            <div class="home-nav">
                <button class="home-btn" onclick="showPage('learning')">
                    <span class="btn-label">H·ªçc t·∫≠p</span>
                </button>
                <button class="home-btn" onclick="showPage('review')">
                    <span class="btn-label">√în t·∫≠p</span>
                </button>
                <button class="home-btn" onclick="showPage('settings')">
                    <span class="btn-label">C√†i ƒë·∫∑t</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ========== LEARNING ========== -->
    <div class="page" id="learning">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <span class="sidebar-title">Th∆∞ m·ª•c</span>
                <button class="back-btn" onclick="showPage('home')" title="V·ªÅ trang ch·ªß">‚Üê</button>
            </div>
            <div class="sidebar-tree" id="sidebarTree" oncontextmenu="onTreeCtx(event,'empty')">
                <!-- tree items injected by JS -->
            </div>
        </div>

        <!-- Workspace -->
        <div class="workspace">
            <div class="workspace-bar">
                <button class="menu-btn" id="menuBtn" onclick="openSidebar()">‚ò∞</button>
                <div class="ws-breadcrumb">
                    <span id="wsBreadcrumb">T·∫•t c·∫£ t√†i li·ªáu</span>
                </div>
            </div>
            <div class="workspace-content" id="workspaceContent">
                <!-- injected by JS -->
            </div>
        </div>

        <!-- FAB ‚Äì always visible on learning page -->
        <button class="fab" id="fabBtn" onclick="showFabMenu()" title="Th√™m file ho·∫∑c folder">
            <span class="fab-icon">Ôºã</span>
            <span class="fab-label" id="fabLabel">Th√™m m·ªõi</span>
        </button>
    </div>

    <!-- ========== BOTTOM SHEET (mobile menu) ========== -->
    <div id="bottomSheetOverlay" onclick="closeBottomSheet()" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:500;backdrop-filter:blur(2px);"></div>
    <div id="bottomSheet" style="
  position:fixed;bottom:0;left:0;right:0;z-index:501;
  background:var(--surface);border-radius:24px 24px 0 0;
  padding:0 0 calc(env(safe-area-inset-bottom,0px) + 20px);
  box-shadow:0 -8px 40px rgba(0,0,0,.18);
  transform:translateY(100%);transition:transform .3s cubic-bezier(.4,0,.2,1);
">
        <div style="width:40px;height:4px;background:var(--border);border-radius:2px;margin:12px auto 4px;"></div>
        <div id="bottomSheetTitle" style="text-align:center;font-size:13px;font-weight:700;color:var(--text2);padding:4px 20px 12px;letter-spacing:1px;text-transform:uppercase;"></div>
        <div id="bottomSheetItems" style="padding:0 12px;"></div>
    </div>

    <!-- ========== FILE EDITOR ========== -->
    <div class="page" id="file-editor">
        <div class="editor-header">
            <button class="back-btn" style="width:36px;height:36px;border-radius:10px;background:var(--border);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;" onclick="showPage('learning')">‚Üê</button>
            <div class="editor-title" id="editorTitle">üìÑ File m·ªõi</div>
            <div class="step-indicator">
                <div class="step active" id="step1Ind">‚ë† Nh·∫≠p t·ª´</div>
                <div class="step" id="step2Ind">‚ë° K·∫øt qu·∫£</div>
            </div>
            <div id="autoSaveBadge" style="font-size:11px;color:#27ae60;font-weight:700;opacity:0;transition:opacity .5s;white-space:nowrap;">‚úÖ ƒê√£ l∆∞u</div>
        </div>
        <div class="editor-body" id="editorBody">
            <!-- injected -->
        </div>
    </div>

    <!-- ========== REVIEW ‚Äì CH·ªåN FILE ========== -->
    <div class="page" id="review">
        <div class="rv-header">
            <button class="back-btn" style="width:36px;height:36px;border-radius:10px;background:var(--border);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;" onclick="showPage('home')">‚Üê</button>
            <div style="font-size:20px;font-weight:700;">√în t·∫≠p</div>
        </div>

        <!-- Unified body: 2-col desktop, 1-col mobile -->
        <div class="rv-body">
            <div class="rv-left">
                <div class="rv-section-title">üìÇ Ch·ªçn file √¥n t·∫≠p</div>
                <div id="reviewFileList" class="rv-file-list">
                    <div class="rv-empty">Ch∆∞a c√≥ file h·ªçc t·∫≠p n√†o.<br>H√£y t·∫°o file trong m·ª•c H·ªçc t·∫≠p!</div>
                </div>
            </div>
            <div class="rv-right">
                <div class="rv-info-card" id="rvInfoCard">
                    <div class="rv-info-icon" id="rvInfoIcon">üìÇ</div>
                    <div id="reviewFileName" class="rv-info-name">Ch·ªçn m·ªôt file b√™n tr√°i</div>
                    <div class="rv-info-meta">
                        <div class="rv-meta-item">
                            <span class="rv-meta-label">S·ªë t·ª´</span>
                            <span id="reviewWordCount" class="rv-meta-val">‚Äî</span>
                        </div>
                        <div class="rv-meta-item">
                            <span class="rv-meta-label">Ng√†y t·∫°o</span>
                            <span id="reviewFileDate" class="rv-meta-val">‚Äî</span>
                        </div>
                    </div>
                    <button id="btnStartReview" class="rv-start-btn" disabled onclick="startReviewSession()">B·∫Øt ƒë·∫ßu √¥n t·∫≠p</button>
                </div>
            </div>
        </div>

        <!-- Mobile sticky bottom bar -->
        <div class="rv-mobile-bar" id="rvMobileBar">
            <div class="rv-mobile-bar-info">
                <div id="rvMobileFileName" class="rv-mobile-bar-name">Ch∆∞a ch·ªçn file</div>
                <div id="rvMobileFileMeta" class="rv-mobile-bar-meta">Nh·∫•n v√†o file ƒë·ªÉ ch·ªçn</div>
            </div>
            <button id="btnStartReviewMobile" class="rv-mobile-bar-btn" disabled onclick="startReviewSession()">B·∫Øt ƒë·∫ßu ‚Üí</button>
        </div>
    </div>

    <!-- ========== REVIEW ‚Äì CH·ªåN TR√í CH∆†I ========== -->
    <div class="page" id="review-game-select">
        <div class="rv-header">
            <button class="back-btn" style="width:36px;height:36px;border-radius:10px;background:var(--border);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;" onclick="showPage('review')">‚Üê</button>
            <div style="font-size:20px;font-weight:700;">Ch·ªçn ch·∫ø ƒë·ªô √¥n t·∫≠p</div>
        </div>
        <div class="rv-gs-wrap">
            <div id="gameSelectGrid" class="rv-gs-grid"></div>
        </div>
    </div>

    <!-- ========== GAME: TR·∫ÆC NGHI·ªÜM ABCD ========== -->
    <div class="page" id="review-game-abc">
        <div class="rv-game-header">
            <button class="back-btn" style="width:36px;height:36px;border-radius:10px;background:var(--border);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;" onclick="showPage('review-game-select')">‚Üê</button>
            <div class="rv-game-title">Tr·∫Øc nghi·ªám ABCD</div>
            <div id="abcProgress" class="rv-game-progress">C√¢u 1/1</div>
        </div>
        <div id="abcScore" class="rv-game-score"></div>
        <div class="rv-game-body" id="abcBody"></div>
    </div>

    <!-- ========== GAME: FLASHCARD ========== -->
    <div class="page" id="review-game-flash">
        <div class="rv-game-header">
            <button class="back-btn" style="width:36px;height:36px;border-radius:10px;background:var(--border);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;" onclick="showPage('review-game-select')">‚Üê</button>
            <div class="rv-game-title">Flashcard</div>
            <div id="flashProgress" class="rv-game-progress">Th·∫ª 1/1</div>
        </div>
        <div id="flashScore" class="rv-game-score"></div>
        <div class="rv-game-body" id="flashBody"></div>
    </div>

    <!-- ========== GAME: NH√åN H√ÅN ‚Üí VI·∫æT NGHƒ®A ========== -->
    <div class="page" id="review-game-write-meaning">
        <div class="rv-game-header">
            <button class="back-btn" style="width:36px;height:36px;border-radius:10px;background:var(--border);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;" onclick="showPage('review-game-select')">‚Üê</button>
            <div class="rv-game-title">‚úç Nh√¨n H√°n ‚Üí vi·∫øt nghƒ©a</div>
            <div id="writeMeanProgress" class="rv-game-progress">C√¢u 1/1</div>
        </div>
        <div id="writeMeanScore" class="rv-game-score"></div>
        <div class="rv-game-body" id="writeMeanBody"></div>
    </div>

    <!-- ========== GAME: NH√åN NGHƒ®A ‚Üí VI·∫æT H√ÅN ========== -->
    <div class="page" id="review-game-write-zh">
        <div class="rv-game-header">
            <button class="back-btn" style="width:36px;height:36px;border-radius:10px;background:var(--border);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;" onclick="showPage('review-game-select')">‚Üê</button>
            <div class="rv-game-title">Nh√¨n nghƒ©a ‚Üí vi·∫øt H√°n</div>
            <div id="writeZhProgress" class="rv-game-progress">C√¢u 1/1</div>
        </div>
        <div id="writeZhScore" class="rv-game-score"></div>
        <div class="rv-game-body" id="writeZhBody"></div>
    </div>

    <!-- ========== K·∫æT QU·∫¢ ========== -->
    <div class="page" id="review-result">
        <div class="rv-header">
            <button class="back-btn" style="width:36px;height:36px;border-radius:10px;background:var(--border);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;" onclick="showPage('review-game-select')">‚Üê</button>
            <div style="font-size:20px;font-weight:700;">K·∫øt qu·∫£</div>
        </div>
        <div class="rv-result-wrap">
            <div id="resultBody" class="rv-result-body"></div>
            <div class="rv-result-btns">
                <button class="confirm-btn" onclick="restartCurrentGame()">Ch∆°i l·∫°i</button>
                <button class="confirm-btn" style="background:linear-gradient(135deg,#e74c3c,#c0392b);" onclick="reviewWrongWords()">üìö √în t·ª´ sai</button>
                <button class="confirm-btn" style="background:linear-gradient(135deg,#6366f1,#4f46e5);" onclick="showPage('review-game-select')">üéÆ Ch·ªçn game kh√°c</button>
            </div>
        </div>
    </div>

    <!-- ========== SETTINGS ========== -->
    <div class="page" id="settings">
        <div class="settings-header" style="max-width:500px;width:100%;">
            <button class="back-btn" style="width:36px;height:36px;border-radius:10px;background:var(--border);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;" onclick="showPage('home')">‚Üê</button>
            <div style="font-size:20px;font-weight:700;">C√†i ƒë·∫∑t</div>
        </div>

        <!-- Giao di·ªán -->
        <div class="settings-card">
            <div class="settings-section-label">üé® Giao di·ªán</div>
            <div class="settings-row">
                <div><div class="settings-label">Ch·∫ø ƒë·ªô t·ªëi</div><div class="settings-desc">Giao di·ªán t·ªëi nh·∫π m·∫Øt ban ƒë√™m</div></div>
                <button class="toggle" id="darkToggle" onclick="toggleTheme()"></button>
            </div>
            <div class="settings-row">
                <div><div class="settings-label">Ph√°t √¢m t·ª± ƒë·ªông</div><div class="settings-desc">Ph√°t √¢m khi hi·ªÉn th·ªã t·ª´ m·ªõi</div></div>
                <button class="toggle" id="audioToggle" onclick="this.classList.toggle('on');saveSettings();showToast('‚úÖ ƒê√£ l∆∞u!')"></button>
            </div>
            <div class="settings-row">
                <div><div class="settings-label">Hi·ªÉn th·ªã Pinyin</div><div class="settings-desc">Lu√¥n hi·ªán phi√™n √¢m b√™n d∆∞·ªõi</div></div>
                <button class="toggle on" id="pinyinToggle" onclick="this.classList.toggle('on');saveSettings();showToast('‚úÖ ƒê√£ l∆∞u!')"></button>
            </div>
            <div class="settings-row">
                <div><div class="settings-label">Nh·∫Øc nh·ªü h·ªçc t·∫≠p</div><div class="settings-desc">Nh·∫≠n th√¥ng b√°o nh·∫Øc h·ªçc m·ªói ng√†y</div></div>
                <button class="toggle on" id="notifToggle" onclick="this.classList.toggle('on');saveSettings();showToast('‚úÖ ƒê√£ l∆∞u!')"></button>
            </div>
        </div>

        <!-- T√†i kho·∫£n -->
        <div class="settings-card">
            <div class="settings-section-label">üë§ T√†i kho·∫£n</div>
            <div class="settings-row">
                <div>
                    <div class="settings-label">T√™n ng∆∞·ªùi d√πng</div>
                    <div class="settings-desc">Hi·ªÉn th·ªã l·ªùi ch√†o tr√™n trang ch·ªß</div>
                </div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <span id="settingsUsername" style="font-weight:700;color:var(--accent1);font-size:15px;">Di·ªáu</span>
                    <button class="settings-edit-btn" onclick="promptEditUsername()" title="ƒê·ªïi t√™n">‚úèÔ∏è</button>
                </div>
            </div>
            <div class="settings-row">
                <div>
                    <div class="settings-label">D·ªØ li·ªáu ƒë√£ l∆∞u</div>
                    <div class="settings-desc">T·ª´ v·ª±ng, file, c√†i ƒë·∫∑t ‚Äì l∆∞u trong tr√¨nh duy·ªát</div>
                </div>
                <div id="storageSizeEl" style="font-size:12px;color:var(--text2);font-weight:700;">...</div>
            </div>
            <div class="settings-row" style="border-bottom:none;">
                <div>
                    <div class="settings-label" style="color:#e74c3c">X√≥a to√†n b·ªô d·ªØ li·ªáu</div>
                    <div class="settings-desc">Kh√¥ng th·ªÉ kh√¥i ph·ª•c sau khi x√≥a</div>
                </div>
                <button class="settings-danger-btn" onclick="confirmClearData()">X√≥a</button>
            </div>
        </div>

        <!-- Th√¥ng tin -->
        <div class="settings-card">
            <div class="settings-section-label">‚ÑπÔ∏è Th√¥ng tin</div>
            <div class="settings-row" style="border-bottom:none;">
                <div><div class="settings-label">Phi√™n b·∫£n</div></div>
                <div style="font-size:13px;color:var(--text2);font-weight:700;">Ê±âËØ≠Â≠¶‰π† v2.0</div>
            </div>
        </div>
    </div>

</body>
</html>
